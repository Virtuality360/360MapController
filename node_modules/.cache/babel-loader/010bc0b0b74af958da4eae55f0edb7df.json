{"ast":null,"code":"/* esri-leaflet-geocoder - v3.1.1 - Thu Jul 29 2021 11:32:59 GMT-0500 (Central Daylight Time)\n * Copyright (c) 2021 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\n!function (e, t) {\n  \"object\" == typeof exports && \"undefined\" != typeof module ? t(exports, require(\"leaflet\"), require(\"esri-leaflet\")) : \"function\" == typeof define && define.amd ? define([\"exports\", \"leaflet\", \"esri-leaflet\"], t) : t(((e = \"undefined\" != typeof globalThis ? globalThis : e || self).L = e.L || {}, e.L.esri = e.L.esri || {}, e.L.esri.Geocoding = {}), e.L, e.L.esri);\n}(this, function (e, u, r) {\n  \"use strict\";\n\n  var t = \"https://geocode-api.arcgis.com/arcgis/rest/services/World/GeocodeServer/\",\n      s = r.Task.extend({\n    path: \"findAddressCandidates\",\n    params: {\n      outSr: 4326,\n      forStorage: !1,\n      outFields: \"*\",\n      maxLocations: 20\n    },\n    setters: {\n      address: \"address\",\n      neighborhood: \"neighborhood\",\n      city: \"city\",\n      subregion: \"subregion\",\n      region: \"region\",\n      postal: \"postal\",\n      country: \"country\",\n      text: \"singleLine\",\n      category: \"category\",\n      token: \"token\",\n      apikey: \"apikey\",\n      key: \"magicKey\",\n      fields: \"outFields\",\n      forStorage: \"forStorage\",\n      maxLocations: \"maxLocations\",\n      countries: \"sourceCountry\"\n    },\n    initialize: function initialize(e) {\n      (e = e || {}).url = e.url || t, r.Task.prototype.initialize.call(this, e);\n    },\n    within: function within(e) {\n      return e = u.latLngBounds(e), this.params.searchExtent = r.Util.boundsToExtent(e), this;\n    },\n    nearby: function nearby(e, t) {\n      e = u.latLng(e);\n      return this.params.location = e.lng + \",\" + e.lat, t && (this.params.distance = Math.min(Math.max(t, 2e3), 5e4)), this;\n    },\n    run: function run(i, o) {\n      return this.options.token && (this.params.token = this.options.token), this.options.apikey && (this.params.token = this.options.apikey), this.options.customParam && (this.params[this.options.customParam] = this.params.singleLine, delete this.params.singleLine), this.request(function (e, t) {\n        var s = this._processGeocoderResponse,\n            s = e ? void 0 : s(t);\n        i.call(o, e, {\n          results: s\n        }, t);\n      }, this);\n    },\n    _processGeocoderResponse: function _processGeocoderResponse(e) {\n      for (var t = [], s = 0; s < e.candidates.length; s++) {\n        var i,\n            o = e.candidates[s];\n        o.extent && (i = r.Util.extentToBounds(o.extent)), t.push({\n          text: o.address,\n          bounds: i,\n          score: o.score,\n          latlng: u.latLng(o.location.y, o.location.x),\n          properties: o.attributes\n        });\n      }\n\n      return t;\n    }\n  });\n\n  function i(e) {\n    return new s(e);\n  }\n\n  var o = r.Task.extend({\n    path: \"reverseGeocode\",\n    params: {\n      outSR: 4326,\n      returnIntersection: !1\n    },\n    setters: {\n      distance: \"distance\",\n      language: \"langCode\",\n      intersection: \"returnIntersection\"\n    },\n    initialize: function initialize(e) {\n      (e = e || {}).url = e.url || t, r.Task.prototype.initialize.call(this, e);\n    },\n    latlng: function latlng(e) {\n      e = u.latLng(e);\n      return this.params.location = e.lng + \",\" + e.lat, this;\n    },\n    run: function run(i, o) {\n      return this.request(function (e, t) {\n        var s = e ? void 0 : {\n          latlng: u.latLng(t.location.y, t.location.x),\n          address: t.address\n        };\n        i.call(o, e, s, t);\n      }, this);\n    }\n  });\n\n  function n(e) {\n    return new o(e);\n  }\n\n  var a = r.Task.extend({\n    path: \"suggest\",\n    params: {},\n    setters: {\n      text: \"text\",\n      category: \"category\",\n      countries: \"countryCode\",\n      maxSuggestions: \"maxSuggestions\"\n    },\n    initialize: function initialize(e) {\n      (e = e || {}).url || (e.url = t, e.supportsSuggest = !0), r.Task.prototype.initialize.call(this, e);\n    },\n    within: function within(e) {\n      var t = (e = u.latLngBounds(e)).getCenter(),\n          s = e.getNorthWest();\n      return this.params.location = t.lng + \",\" + t.lat, this.params.distance = Math.min(Math.max(t.distanceTo(s), 2e3), 5e4), this.params.searchExtent = r.Util.boundsToExtent(e), this;\n    },\n    nearby: function nearby(e, t) {\n      e = u.latLng(e);\n      return this.params.location = e.lng + \",\" + e.lat, t && (this.params.distance = Math.min(Math.max(t, 2e3), 5e4)), this;\n    },\n    run: function run(s, i) {\n      if (this.options.supportsSuggest) return this.request(function (e, t) {\n        s.call(i, e, t, t);\n      }, this);\n      console.warn(\"this geocoding service does not support asking for suggestions\");\n    }\n  });\n\n  function l(e) {\n    return new a(e);\n  }\n\n  var h = r.Service.extend({\n    initialize: function initialize(e) {\n      (e = e || {}).apikey && (e.token = e.apikey), e.url ? (r.Service.prototype.initialize.call(this, e), this._confirmSuggestSupport()) : (e.url = t, e.supportsSuggest = !0, r.Service.prototype.initialize.call(this, e));\n    },\n    geocode: function geocode() {\n      return i(this);\n    },\n    reverse: function reverse() {\n      return n(this);\n    },\n    suggest: function suggest() {\n      return l(this);\n    },\n    _confirmSuggestSupport: function _confirmSuggestSupport() {\n      this.metadata(function (e, t) {\n        e || (t.capabilities && -1 < t.capabilities.indexOf(\"Suggest\") ? this.options.supportsSuggest = !0 : this.options.supportsSuggest = !1, this.options.customParam = t.singleLineAddressField.name);\n      }, this);\n    }\n  });\n  var d = u.Evented.extend({\n    options: {\n      zoomToResult: !0,\n      useMapBounds: 12,\n      searchBounds: null\n    },\n    initialize: function initialize(e, t) {\n      if (u.Util.setOptions(this, t), this._control = e, !t || !t.providers || !t.providers.length) throw new Error(\"You must specify at least one provider\");\n      this._providers = t.providers;\n    },\n    _geocode: function _geocode(s, e, t) {\n      var i,\n          o = 0,\n          r = [],\n          n = u.Util.bind(function (e, t) {\n        o--, e || (t && (r = r.concat(t)), o <= 0 && (i = this._boundsFromResults(r), this.fire(\"results\", {\n          results: r,\n          bounds: i,\n          latlng: i ? i.getCenter() : void 0,\n          text: s\n        }, !0), this.options.zoomToResult && i && this._control._map.fitBounds(i), this.fire(\"load\")));\n      }, this);\n      if (e) o++, t.results(s, e, this._searchBounds(), n);else for (var a = 0; a < this._providers.length; a++) {\n        o++, this._providers[a].results(s, e, this._searchBounds(), n);\n      }\n    },\n    _suggest: function _suggest(e) {\n      var r = this._providers.length,\n          n = 0,\n          t = u.Util.bind(function (i, o) {\n        return u.Util.bind(function (e, t) {\n          if (r -= 1, n += t.length, e) return this._control._clearProviderSuggestions(o), void this._control._finalizeSuggestions(r, n);\n          if (t.length) for (var s = 0; s < t.length; s++) {\n            t[s].provider = o;\n          } else this._control._renderSuggestions(t);\n          o._lastRender !== i && this._control._clearProviderSuggestions(o), t.length && this._control._input.value === i && (o._lastRender = i, this._control._renderSuggestions(t)), this._control._finalizeSuggestions(r, n);\n        }, this);\n      }, this);\n      this._pendingSuggestions = [];\n\n      for (var s = 0; s < this._providers.length; s++) {\n        var i = this._providers[s],\n            i = i.suggestions(e, this._searchBounds(), t(e, i));\n\n        this._pendingSuggestions.push(i);\n      }\n    },\n    _searchBounds: function _searchBounds() {\n      return null !== this.options.searchBounds ? this.options.searchBounds : !1 !== this.options.useMapBounds && (!0 === this.options.useMapBounds || this.options.useMapBounds <= this._control._map.getZoom()) ? this._control._map.getBounds() : null;\n    },\n    _boundsFromResults: function _boundsFromResults(e) {\n      if (e.length) {\n        for (var t = u.latLngBounds([0, 0], [0, 0]), s = [], i = [], o = e.length - 1; 0 <= o; o--) {\n          var r = e[o];\n          i.push(r.latlng), r.bounds && r.bounds.isValid() && !r.bounds.equals(t) && s.push(r.bounds);\n        }\n\n        for (var n = u.latLngBounds(i), a = 0; a < s.length; a++) {\n          n.extend(s[a]);\n        }\n\n        return n;\n      }\n    },\n    _getAttribution: function _getAttribution() {\n      for (var e = [], t = this._providers, s = 0; s < t.length; s++) {\n        t[s].options.attribution && e.push(t[s].options.attribution);\n      }\n\n      return e.join(\", \");\n    }\n  });\n\n  function c(e, t) {\n    return new d(e, t);\n  }\n\n  var p = h.extend({\n    options: {\n      label: \"Places and Addresses\",\n      maxResults: 5\n    },\n    suggestions: function suggestions(e, t, r) {\n      e = this.suggest().text(e);\n      return t && e.within(t), this.options.nearby && e.nearby(this.options.nearby), this.options.countries && e.countries(this.options.countries), this.options.categories && e.category(this.options.categories), e.maxSuggestions(this.options.maxResults), e.run(function (e, t, s) {\n        var i = [];\n        if (!e) for (; s.suggestions.length && i.length <= this.options.maxResults - 1;) {\n          var o = s.suggestions.shift();\n          o.isCollection || i.push({\n            text: o.text,\n            unformattedText: o.text,\n            magicKey: o.magicKey\n          });\n        }\n        r(e, i);\n      }, this);\n    },\n    results: function results(e, t, s, i) {\n      e = this.geocode().text(e);\n      return t && e.key(t), e.maxLocations(this.options.maxResults), s && e.within(s), this.options.forStorage && e.forStorage(!0), this.options.nearby && e.nearby(this.options.nearby), this.options.countries && e.countries(this.options.countries), this.options.categories && e.category(this.options.categories), e.run(function (e, t) {\n        i(e, t.results);\n      }, this);\n    }\n  });\n\n  function g(e) {\n    return new p(e);\n  }\n\n  var f = u.Control.extend({\n    includes: u.Evented.prototype,\n    options: {\n      position: \"topleft\",\n      collapseAfterResult: !0,\n      expanded: !1,\n      allowMultipleResults: !0,\n      placeholder: \"Search for places or addresses\",\n      title: \"Location Search\"\n    },\n    initialize: function initialize(e) {\n      u.Util.setOptions(this, e), e && e.providers && e.providers.length || ((e = e || {}).providers = [g()]), this._geosearchCore = c(this, e), this._geosearchCore._providers = e.providers, this._geosearchCore.addEventParent(this);\n\n      for (var t = 0; t < this._geosearchCore._providers.length; t++) {\n        this._geosearchCore._providers[t].addEventParent(this);\n      }\n\n      this._geosearchCore._pendingSuggestions = [], u.Control.prototype.initialize.call(this, e);\n    },\n    _renderSuggestions: function _renderSuggestions(e) {\n      var t, s, i;\n      0 < e.length && (this._suggestions.style.display = \"block\");\n\n      for (var o = [], r = 0; r < e.length; r++) {\n        var n = e[r];\n\n        if (!i && 1 < this._geosearchCore._providers.length && t !== n.provider.options.label && ((i = u.DomUtil.create(\"div\", \"geocoder-control-header\", n.provider._contentsElement)).textContent = n.provider.options.label, i.innerText = n.provider.options.label, t = n.provider.options.label), s = s || u.DomUtil.create(\"ul\", \"geocoder-control-list\", n.provider._contentsElement), -1 === o.indexOf(n.text)) {\n          var a = u.DomUtil.create(\"li\", \"geocoder-control-suggestion\", s);\n          a.innerHTML = n.text, a.provider = n.provider, a[\"data-magic-key\"] = n.magicKey, a.unformattedText = n.unformattedText;\n        } else for (var l = 0; l < s.childNodes.length; l++) {\n          s.childNodes[l].innerHTML === n.text && (s.childNodes[l][\"data-magic-key\"] += \",\" + n.magicKey);\n        }\n\n        o.push(n.text);\n      }\n\n      -1 < this.getPosition().indexOf(\"top\") && (this._suggestions.style.maxHeight = this._map.getSize().y - this._suggestions.offsetTop - this._wrapper.offsetTop - 10 + \"px\"), -1 < this.getPosition().indexOf(\"bottom\") && this._setSuggestionsBottomPosition();\n    },\n    _setSuggestionsBottomPosition: function _setSuggestionsBottomPosition() {\n      this._suggestions.style.maxHeight = this._map.getSize().y - this._map._controlCorners[this.getPosition()].offsetHeight - this._wrapper.offsetHeight + \"px\", this._suggestions.style.top = -this._suggestions.offsetHeight - this._wrapper.offsetHeight + 20 + \"px\";\n    },\n    _boundsFromResults: function _boundsFromResults(e) {\n      if (e.length) {\n        for (var t = u.latLngBounds([0, 0], [0, 0]), s = [], i = [], o = e.length - 1; 0 <= o; o--) {\n          var r = e[o];\n          i.push(r.latlng), r.bounds && r.bounds.isValid() && !r.bounds.equals(t) && s.push(r.bounds);\n        }\n\n        for (var n = u.latLngBounds(i), a = 0; a < s.length; a++) {\n          n.extend(s[a]);\n        }\n\n        return n;\n      }\n    },\n    clear: function clear() {\n      this._clearAllSuggestions(), this.options.collapseAfterResult && (this._input.value = \"\", this._lastValue = \"\", this._input.placeholder = \"\", u.DomUtil.removeClass(this._wrapper, \"geocoder-control-expanded\")), !this._map.scrollWheelZoom.enabled() && this._map.options.scrollWheelZoom && this._map.scrollWheelZoom.enable();\n    },\n    _clearAllSuggestions: function _clearAllSuggestions() {\n      this._suggestions.style.display = \"none\";\n\n      for (var e = 0; e < this.options.providers.length; e++) {\n        this._clearProviderSuggestions(this.options.providers[e]);\n      }\n    },\n    _clearProviderSuggestions: function _clearProviderSuggestions(e) {\n      e._contentsElement.innerHTML = \"\";\n    },\n    _finalizeSuggestions: function _finalizeSuggestions(e, t) {\n      e || (u.DomUtil.removeClass(this._input, \"geocoder-control-loading\"), -1 < this.getPosition().indexOf(\"bottom\") && this._setSuggestionsBottomPosition(), t || this._clearAllSuggestions());\n    },\n    _setupClick: function _setupClick() {\n      u.DomUtil.addClass(this._wrapper, \"geocoder-control-expanded\"), this._input.focus();\n    },\n    disable: function disable() {\n      this._input.disabled = !0, u.DomUtil.addClass(this._input, \"geocoder-control-input-disabled\"), u.DomEvent.removeListener(this._wrapper, \"click\", this._setupClick, this);\n    },\n    enable: function enable() {\n      this._input.disabled = !1, u.DomUtil.removeClass(this._input, \"geocoder-control-input-disabled\"), u.DomEvent.addListener(this._wrapper, \"click\", this._setupClick, this);\n    },\n    getAttribution: function getAttribution() {\n      for (var e = [], t = 0; t < this._providers.length; t++) {\n        this._providers[t].options.attribution && e.push(this._providers[t].options.attribution);\n      }\n\n      return e.join(\", \");\n    },\n    geocodeSuggestion: function geocodeSuggestion(e) {\n      e = e.target || e.srcElement;\n      e.classList.contains(\"geocoder-control-suggestions\") || e.classList.contains(\"geocoder-control-header\") || (e.classList.length < 1 && (e = e.parentNode), this._geosearchCore._geocode(e.unformattedText, e[\"data-magic-key\"], e.provider), this.clear());\n    },\n    onAdd: function onAdd(t) {\n      r.Util.setEsriAttribution(t), this._map = t, this._wrapper = u.DomUtil.create(\"div\", \"geocoder-control\"), this._input = u.DomUtil.create(\"input\", \"geocoder-control-input leaflet-bar\", this._wrapper), this._input.title = this.options.title, this.options.expanded && (u.DomUtil.addClass(this._wrapper, \"geocoder-control-expanded\"), this._input.placeholder = this.options.placeholder), this._suggestions = u.DomUtil.create(\"div\", \"geocoder-control-suggestions leaflet-bar\", this._wrapper);\n\n      for (var e = 0; e < this.options.providers.length; e++) {\n        this.options.providers[e]._contentsElement = u.DomUtil.create(\"div\", null, this._suggestions);\n      }\n\n      var s = this._geosearchCore._getAttribution();\n\n      return t.attributionControl && t.attributionControl.addAttribution(s), u.DomEvent.addListener(this._input, \"focus\", function (e) {\n        this._input.placeholder = this.options.placeholder, u.DomUtil.addClass(this._wrapper, \"geocoder-control-expanded\");\n      }, this), u.DomEvent.addListener(this._wrapper, \"click\", this._setupClick, this), u.DomEvent.addListener(this._suggestions, \"mousedown\", this.geocodeSuggestion, this), u.DomEvent.addListener(this._input, \"blur\", function (e) {\n        this.clear();\n      }, this), u.DomEvent.addListener(this._input, \"keydown\", function (e) {\n        var t = (e.target || e.srcElement).value;\n        u.DomUtil.addClass(this._wrapper, \"geocoder-control-expanded\");\n\n        for (var s, i = this._suggestions.querySelectorAll(\".geocoder-control-suggestion\"), o = this._suggestions.querySelectorAll(\".geocoder-control-selected\")[0], r = 0; r < i.length; r++) {\n          if (i[r] === o) {\n            s = r;\n            break;\n          }\n        }\n\n        switch (e.keyCode) {\n          case 13:\n            o ? (this._input.value = o.innerText, this._geosearchCore._geocode(o.unformattedText, o[\"data-magic-key\"], o.provider), this.clear()) : this.options.allowMultipleResults && 2 <= t.length ? (this._geosearchCore._geocode(this._input.value, void 0), this.clear()) : 1 === i.length ? (u.DomUtil.addClass(i[0], \"geocoder-control-selected\"), this._geosearchCore._geocode(i[0].innerHTML, i[0][\"data-magic-key\"], i[0].provider)) : (this.clear(), this._input.blur()), u.DomEvent.preventDefault(e);\n            break;\n\n          case 38:\n            o && u.DomUtil.removeClass(o, \"geocoder-control-selected\");\n            var n = i[s - 1];\n            o && n ? u.DomUtil.addClass(n, \"geocoder-control-selected\") : u.DomUtil.addClass(i[i.length - 1], \"geocoder-control-selected\"), u.DomEvent.preventDefault(e);\n            break;\n\n          case 40:\n            o && u.DomUtil.removeClass(o, \"geocoder-control-selected\");\n            n = i[s + 1];\n            o && n ? u.DomUtil.addClass(n, \"geocoder-control-selected\") : u.DomUtil.addClass(i[0], \"geocoder-control-selected\"), u.DomEvent.preventDefault(e);\n            break;\n\n          default:\n            for (var a = 0; a < this._geosearchCore._pendingSuggestions.length; a++) {\n              var l = this._geosearchCore._pendingSuggestions[a];\n              l && l.abort && !l.id && l.abort();\n            }\n\n        }\n      }, this), u.DomEvent.addListener(this._input, \"keyup\", u.Util.throttle(function (e) {\n        var t = e.which || e.keyCode,\n            e = (e.target || e.srcElement).value;\n        if (e.length < 2) return this._lastValue = this._input.value, this._clearAllSuggestions(), void u.DomUtil.removeClass(this._input, \"geocoder-control-loading\");\n        27 !== t ? 13 !== t && 38 !== t && 40 !== t && this._input.value !== this._lastValue && (this._lastValue = this._input.value, u.DomUtil.addClass(this._input, \"geocoder-control-loading\"), this._geosearchCore._suggest(e)) : this._clearAllSuggestions();\n      }, 50, this), this), u.DomEvent.disableClickPropagation(this._wrapper), u.DomEvent.addListener(this._suggestions, \"mouseover\", function (e) {\n        t.scrollWheelZoom.enabled() && t.options.scrollWheelZoom && t.scrollWheelZoom.disable();\n      }), u.DomEvent.addListener(this._suggestions, \"mouseout\", function (e) {\n        !t.scrollWheelZoom.enabled() && t.options.scrollWheelZoom && t.scrollWheelZoom.enable();\n      }), this._geosearchCore.on(\"load\", function (e) {\n        u.DomUtil.removeClass(this._input, \"geocoder-control-loading\"), this.clear(), this._input.blur();\n      }, this), this._wrapper;\n    }\n  });\n  var v = r.FeatureLayerService.extend({\n    options: {\n      label: \"Feature Layer\",\n      maxResults: 5,\n      bufferRadius: 1e3,\n      searchMode: \"contain\",\n      formatSuggestion: function formatSuggestion(e) {\n        return e.properties[this.options.searchFields[0]];\n      }\n    },\n    initialize: function initialize(e) {\n      e.apikey && (e.token = e.apikey), r.FeatureLayerService.prototype.initialize.call(this, e), \"string\" == typeof this.options.searchFields && (this.options.searchFields = [this.options.searchFields]), this._suggestionsQuery = this.query(), this._resultsQuery = this.query();\n    },\n    suggestions: function suggestions(e, t, n) {\n      e = this._suggestionsQuery.where(this._buildQuery(e)).returnGeometry(!1);\n      return t && e.intersects(t), this.options.idField && e.fields([this.options.idField].concat(this.options.searchFields)), e.run(function (e, t, s) {\n        if (e) n(e, []);else {\n          this.options.idField = s.objectIdFieldName;\n\n          for (var i = [], o = t.features.length - 1; 0 <= o; o--) {\n            var r = t.features[o];\n            i.push({\n              text: this.options.formatSuggestion.call(this, r),\n              unformattedText: r.properties[this.options.searchFields[0]],\n              magicKey: r.id\n            });\n          }\n\n          n(e, i.slice(0, this.options.maxResults));\n        }\n      }, this);\n    },\n    results: function results(e, t, s, n) {\n      var i = this._resultsQuery;\n      return t ? (delete i.params.where, i.featureIds([t])) : i.where(this._buildQuery(e)), s && i.within(s), i.run(u.Util.bind(function (e, t) {\n        for (var s = [], i = 0; i < t.features.length; i++) {\n          var o,\n              r = t.features[i];\n          r && (r = {\n            latlng: (o = this._featureBounds(r)).getCenter(),\n            bounds: o,\n            text: this.options.formatSuggestion.call(this, r),\n            properties: r.properties,\n            geojson: r\n          }, s.push(r), delete this._resultsQuery.params.objectIds);\n        }\n\n        n(e, s);\n      }, this));\n    },\n    orderBy: function orderBy(e, t) {\n      this._suggestionsQuery.orderBy(e, t);\n    },\n    _buildQuery: function _buildQuery(e) {\n      for (var t = [], s = this.options.searchFields.length - 1; 0 <= s; s--) {\n        var i = 'upper(\"' + this.options.searchFields[s] + '\")';\n        if (\"contain\" === this.options.searchMode) t.push(i + \" LIKE upper('%\" + e + \"%')\");else if (\"startWith\" === this.options.searchMode) t.push(i + \" LIKE upper('\" + e + \"%')\");else if (\"endWith\" === this.options.searchMode) t.push(i + \" LIKE upper('%\" + e + \"')\");else {\n          if (\"strict\" !== this.options.searchMode) throw new Error('L.esri.Geocoding.featureLayerProvider: Invalid parameter for \"searchMode\". Use one of \"contain\", \"startWith\", \"endWith\", or \"strict\"');\n          t.push(i + \" LIKE upper('\" + e + \"')\");\n        }\n      }\n\n      return this.options.where ? this.options.where + \" AND (\" + t.join(\" OR \") + \")\" : t.join(\" OR \");\n    },\n    _featureBounds: function _featureBounds(e) {\n      var t = u.geoJson(e);\n      if (\"Point\" !== e.geometry.type) return t.getBounds();\n      var s = t.getBounds().getCenter(),\n          e = this.options.bufferRadius / 40075017 * 360 / Math.cos(180 / Math.PI * s.lat),\n          t = this.options.bufferRadius / 40075017 * 360;\n      return u.latLngBounds([s.lat - t, s.lng - e], [s.lat + t, s.lng + e]);\n    }\n  });\n  var m = r.MapService.extend({\n    options: {\n      layers: [0],\n      label: \"Map Service\",\n      bufferRadius: 1e3,\n      maxResults: 5,\n      formatSuggestion: function formatSuggestion(e) {\n        return e.properties[e.displayFieldName] + \" <small>\" + e.layerName + \"</small>\";\n      }\n    },\n    initialize: function initialize(e) {\n      e.apikey && (e.token = e.apikey), r.MapService.prototype.initialize.call(this, e), this._getIdFields();\n    },\n    suggestions: function suggestions(e, t, h) {\n      return this.find().text(e).fields(this.options.searchFields).returnGeometry(!1).layers(this.options.layers).run(function (e, t, s) {\n        var i = [];\n\n        if (!e) {\n          var o = Math.min(this.options.maxResults, t.features.length);\n          s.results = s.results.reverse();\n\n          for (var r = 0; r < o; r++) {\n            var n = t.features[r],\n                a = s.results[r],\n                l = a.layerId,\n                u = this._idFields[l];\n            n.layerId = l, n.layerName = this._layerNames[l], n.displayFieldName = this._displayFields[l], u && i.push({\n              text: this.options.formatSuggestion.call(this, n),\n              unformattedText: n.properties[n.displayFieldName],\n              magicKey: a.attributes[u] + \":\" + l\n            });\n          }\n        }\n\n        h(e, i.reverse());\n      }, this);\n    },\n    results: function results(e, t, s, n) {\n      var i,\n          a,\n          l = [];\n      return (t && !t.includes(\",\") ? (i = t.split(\":\")[0], a = t.split(\":\")[1], this.query().layer(a).featureIds(i)) : this.find().text(e).fields(this.options.searchFields).layers(this.options.layers)).run(function (e, t, s) {\n        if (!e) {\n          s.results && (s.results = s.results.reverse());\n\n          for (var i = 0; i < t.features.length; i++) {\n            var o,\n                r = t.features[i];\n            a = a || s.results[i].layerId, r && void 0 !== a && (o = this._featureBounds(r), r.layerId = a, r.layerName = this._layerNames[a], r.displayFieldName = this._displayFields[a], r = {\n              latlng: o.getCenter(),\n              bounds: o,\n              text: this.options.formatSuggestion.call(this, r),\n              properties: r.properties,\n              geojson: r\n            }, l.push(r));\n          }\n        }\n\n        n(e, l.reverse());\n      }, this);\n    },\n    _featureBounds: function _featureBounds(e) {\n      var t = u.geoJson(e);\n      if (\"Point\" !== e.geometry.type) return t.getBounds();\n      var s = t.getBounds().getCenter(),\n          e = this.options.bufferRadius / 40075017 * 360 / Math.cos(180 / Math.PI * s.lat),\n          t = this.options.bufferRadius / 40075017 * 360;\n      return u.latLngBounds([s.lat - t, s.lng - e], [s.lat + t, s.lng + e]);\n    },\n    _layerMetadataCallback: function _layerMetadataCallback(o) {\n      return u.Util.bind(function (e, t) {\n        if (!e) {\n          this._displayFields[o] = t.displayField, this._layerNames[o] = t.name;\n\n          for (var s = 0; s < t.fields.length; s++) {\n            var i = t.fields[s];\n\n            if (\"esriFieldTypeOID\" === i.type) {\n              this._idFields[o] = i.name;\n              break;\n            }\n          }\n        }\n      }, this);\n    },\n    _getIdFields: function _getIdFields() {\n      this._idFields = {}, this._displayFields = {}, this._layerNames = {};\n\n      for (var e = 0; e < this.options.layers.length; e++) {\n        var t = this.options.layers[e];\n        this.get(t, {}, this._layerMetadataCallback(t));\n      }\n    }\n  });\n\n  var _ = h.extend({\n    options: {\n      label: \"Geocode Server\",\n      maxResults: 5\n    },\n    suggestions: function suggestions(e, t, r) {\n      if (this.options.supportsSuggest) {\n        e = this.suggest().text(e);\n        return t && e.within(t), e.run(function (e, t, s) {\n          var i = [];\n          if (!e) for (; s.suggestions.length && i.length <= this.options.maxResults - 1;) {\n            var o = s.suggestions.shift();\n            o.isCollection || i.push({\n              text: o.text,\n              unformattedText: o.text,\n              magicKey: o.magicKey\n            });\n          }\n          r(e, i);\n        }, this);\n      }\n\n      return r(void 0, []), !1;\n    },\n    results: function results(e, t, s, i) {\n      e = this.geocode().text(e);\n      return t && e.key(t), e.maxLocations(this.options.maxResults), s && e.within(s), e.run(function (e, t) {\n        i(e, t.results);\n      }, this);\n    }\n  });\n\n  e.ArcgisOnlineProvider = p, e.FeatureLayerProvider = v, e.Geocode = s, e.GeocodeService = h, e.GeocodeServiceProvider = _, e.Geosearch = f, e.GeosearchCore = d, e.MapServiceProvider = m, e.ReverseGeocode = o, e.Suggest = a, e.VERSION = \"3.1.1\", e.WorldGeocodingServiceUrl = t, e.arcgisOnlineProvider = g, e.featureLayerProvider = function (e) {\n    return new v(e);\n  }, e.geocode = i, e.geocodeService = function (e) {\n    return new h(e);\n  }, e.geocodeServiceProvider = function (e) {\n    return new _(e);\n  }, e.geosearch = function (e) {\n    return new f(e);\n  }, e.geosearchCore = c, e.mapServiceProvider = function (e) {\n    return new m(e);\n  }, e.reverseGeocode = n, e.suggest = l, Object.defineProperty(e, \"__esModule\", {\n    value: !0\n  });\n});","map":{"version":3,"sources":["../src/helper.js","../src/Tasks/Geocode.js","../src/Tasks/ReverseGeocode.js","../src/Tasks/Suggest.js","../src/Services/Geocode.js","../src/Classes/GeosearchCore.js","../src/Providers/ArcgisOnlineGeocoder.js","../src/Controls/Geosearch.js","../src/Providers/FeatureLayer.js","../src/Providers/MapService.js","../src/Providers/GeocodeService.js"],"names":["WorldGeocodingServiceUrl","Geocode","Task","extend","path","params","outSr","forStorage","outFields","maxLocations","setters","address","neighborhood","city","subregion","region","postal","country","text","category","token","apikey","key","fields","countries","initialize","options","url","prototype","call","this","within","bounds","latLngBounds","searchExtent","EsriUtil","boundsToExtent","nearby","coords","radius","centroid","latLng","location","lng","lat","distance","Math","min","max","run","callback","context","customParam","singleLine","request","error","response","processor","_processGeocoderResponse","results","undefined","i","candidates","length","candidate","extent","extentToBounds","push","score","latlng","y","x","properties","attributes","geocode","ReverseGeocode","outSR","returnIntersection","language","intersection","result","reverseGeocode","Suggest","maxSuggestions","supportsSuggest","center","getCenter","ne","getNorthWest","distanceTo","console","warn","suggest","GeocodeService","Service","_confirmSuggestSupport","reverse","metadata","capabilities","indexOf","singleLineAddressField","name","GeosearchCore","Evented","zoomToResult","useMapBounds","searchBounds","control","Util","setOptions","_control","providers","Error","_providers","_geocode","provider","activeRequests","allResults","bind","concat","_boundsFromResults","fire","_map","fitBounds","_searchBounds","_suggest","suggestionsLength","createCallback","suggestions","_clearProviderSuggestions","_finalizeSuggestions","_renderSuggestions","_lastRender","_input","value","_pendingSuggestions","getBounds","getZoom","nullIsland","resultBounds","resultLatlngs","isValid","equals","j","_getAttribution","attribs","attribution","join","geosearchCore","ArcgisOnlineProvider","label","maxResults","categories","suggestion","shift","isCollection","unformattedText","magicKey","arcgisOnlineProvider","Geosearch","Control","includes","position","collapseAfterResult","expanded","allowMultipleResults","placeholder","title","_geosearchCore","addEventParent","currentGroup","_suggestions","style","display","list","header","suggestionTextArray","DomUtil","create","_contentsElement","textContent","innerText","suggestionItem","innerHTML","childNodes","getPosition","maxHeight","getSize","offsetTop","_wrapper","_setSuggestionsBottomPosition","_controlCorners","offsetHeight","top","clear","_clearAllSuggestions","_lastValue","removeClass","scrollWheelZoom","enabled","enable","_setupClick","addClass","focus","disable","disabled","DomEvent","removeListener","addListener","getAttribution","geocodeSuggestion","e","target","srcElement","classList","contains","parentNode","onAdd","map","setEsriAttribution","credits","attributionControl","addAttribution","querySelectorAll","selected","selectedPosition","keyCode","blur","preventDefault","previousItem","nextItem","abort","id","throttle","which","disableClickPropagation","on","FeatureLayerProvider","FeatureLayerService","bufferRadius","searchMode","formatSuggestion","feature","searchFields","_suggestionsQuery","query","_resultsQuery","where","_buildQuery","returnGeometry","intersects","idField","raw","objectIdFieldName","features","slice","featureIds","_featureBounds","geojson","orderBy","fieldName","order","queryString","field","geoJson","geometry","type","lngRadius","cos","PI","latRadius","MapServiceProvider","MapService","layers","displayFieldName","layerName","_getIdFields","find","count","layer","layerId","_idFields","_layerNames","_displayFields","featureId","split","_layerMetadataCallback","layerid","displayField","get","GeocodeServiceProvider"],"mappings":"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","sourcesContent":["export var WorldGeocodingServiceUrl = 'https://geocode-api.arcgis.com/arcgis/rest/services/World/GeocodeServer/';\r\n","import {\r\n  latLng,\r\n  latLngBounds\r\n} from 'leaflet';\r\nimport { Task, Util as EsriUtil } from 'esri-leaflet';\r\nimport { WorldGeocodingServiceUrl } from '../helper';\r\n\r\nexport var Geocode = Task.extend({\r\n  path: 'findAddressCandidates',\r\n\r\n  params: {\r\n    outSr: 4326,\r\n    forStorage: false,\r\n    outFields: '*',\r\n    maxLocations: 20\r\n  },\r\n\r\n  setters: {\r\n    'address': 'address',\r\n    'neighborhood': 'neighborhood',\r\n    'city': 'city',\r\n    'subregion': 'subregion',\r\n    'region': 'region',\r\n    'postal': 'postal',\r\n    'country': 'country',\r\n    'text': 'singleLine',\r\n    'category': 'category',\r\n    'token': 'token',\r\n    'apikey': 'apikey',\r\n    'key': 'magicKey',\r\n    'fields': 'outFields',\r\n    'forStorage': 'forStorage',\r\n    'maxLocations': 'maxLocations',\r\n    // World Geocoding Service (only works with singleLine)\r\n    'countries': 'sourceCountry'\r\n  },\r\n\r\n  initialize: function (options) {\r\n    options = options || {};\r\n    options.url = options.url || WorldGeocodingServiceUrl;\r\n    Task.prototype.initialize.call(this, options);\r\n  },\r\n\r\n  within: function (bounds) {\r\n    bounds = latLngBounds(bounds);\r\n    this.params.searchExtent = EsriUtil.boundsToExtent(bounds);\r\n    return this;\r\n  },\r\n\r\n  nearby: function (coords, radius) {\r\n    var centroid = latLng(coords);\r\n    this.params.location = centroid.lng + ',' + centroid.lat;\r\n    if (radius) {\r\n      this.params.distance = Math.min(Math.max(radius, 2000), 50000);\r\n    }\r\n    return this;\r\n  },\r\n\r\n  run: function (callback, context) {\r\n    if (this.options.token) {\r\n      this.params.token = this.options.token;\r\n    }\r\n    if (this.options.apikey) {\r\n      this.params.token = this.options.apikey;\r\n    }\r\n    if (this.options.customParam) {\r\n      this.params[this.options.customParam] = this.params.singleLine;\r\n      delete this.params.singleLine;\r\n    }\r\n\r\n    return this.request(function (error, response) {\r\n      var processor = this._processGeocoderResponse;\r\n      var results = (!error) ? processor(response) : undefined;\r\n      callback.call(context, error, { results: results }, response);\r\n    }, this);\r\n  },\r\n\r\n  _processGeocoderResponse: function (response) {\r\n    var results = [];\r\n\r\n    for (var i = 0; i < response.candidates.length; i++) {\r\n      var candidate = response.candidates[i];\r\n      if (candidate.extent) {\r\n        var bounds = EsriUtil.extentToBounds(candidate.extent);\r\n      }\r\n\r\n      results.push({\r\n        text: candidate.address,\r\n        bounds: bounds,\r\n        score: candidate.score,\r\n        latlng: latLng(candidate.location.y, candidate.location.x),\r\n        properties: candidate.attributes\r\n      });\r\n    }\r\n    return results;\r\n  }\r\n});\r\n\r\nexport function geocode (options) {\r\n  return new Geocode(options);\r\n}\r\n\r\nexport default geocode;\r\n","import { latLng } from 'leaflet';\r\nimport { Task } from 'esri-leaflet';\r\nimport { WorldGeocodingServiceUrl } from '../helper';\r\n\r\nexport var ReverseGeocode = Task.extend({\r\n  path: 'reverseGeocode',\r\n\r\n  params: {\r\n    outSR: 4326,\r\n    returnIntersection: false\r\n  },\r\n\r\n  setters: {\r\n    'distance': 'distance',\r\n    'language': 'langCode',\r\n    'intersection': 'returnIntersection'\r\n  },\r\n\r\n  initialize: function (options) {\r\n    options = options || {};\r\n    options.url = options.url || WorldGeocodingServiceUrl;\r\n    Task.prototype.initialize.call(this, options);\r\n  },\r\n\r\n  latlng: function (coords) {\r\n    var centroid = latLng(coords);\r\n    this.params.location = centroid.lng + ',' + centroid.lat;\r\n    return this;\r\n  },\r\n\r\n  run: function (callback, context) {\r\n    return this.request(function (error, response) {\r\n      var result;\r\n\r\n      if (!error) {\r\n        result = {\r\n          latlng: latLng(response.location.y, response.location.x),\r\n          address: response.address\r\n        };\r\n      } else {\r\n        result = undefined;\r\n      }\r\n\r\n      callback.call(context, error, result, response);\r\n    }, this);\r\n  }\r\n});\r\n\r\nexport function reverseGeocode (options) {\r\n  return new ReverseGeocode(options);\r\n}\r\n\r\nexport default reverseGeocode;\r\n","import {\r\n  latLng,\r\n  latLngBounds\r\n} from 'leaflet';\r\nimport { Task, Util as EsriUtil } from 'esri-leaflet';\r\nimport { WorldGeocodingServiceUrl } from '../helper';\r\n\r\nexport var Suggest = Task.extend({\r\n  path: 'suggest',\r\n\r\n  params: {},\r\n\r\n  setters: {\r\n    text: 'text',\r\n    category: 'category',\r\n    countries: 'countryCode',\r\n    maxSuggestions: 'maxSuggestions'\r\n  },\r\n\r\n  initialize: function (options) {\r\n    options = options || {};\r\n    if (!options.url) {\r\n      options.url = WorldGeocodingServiceUrl;\r\n      options.supportsSuggest = true;\r\n    }\r\n    Task.prototype.initialize.call(this, options);\r\n  },\r\n\r\n  within: function (bounds) {\r\n    bounds = latLngBounds(bounds);\r\n    var center = bounds.getCenter();\r\n    var ne = bounds.getNorthWest();\r\n    this.params.location = center.lng + ',' + center.lat;\r\n    this.params.distance = Math.min(Math.max(center.distanceTo(ne), 2000), 50000);\r\n    this.params.searchExtent = EsriUtil.boundsToExtent(bounds);\r\n    return this;\r\n  },\r\n\r\n  nearby: function (coords, radius) {\r\n    var centroid = latLng(coords);\r\n    this.params.location = centroid.lng + ',' + centroid.lat;\r\n    if (radius) {\r\n      this.params.distance = Math.min(Math.max(radius, 2000), 50000);\r\n    }\r\n    return this;\r\n  },\r\n\r\n  run: function (callback, context) {\r\n    if (this.options.supportsSuggest) {\r\n      return this.request(function (error, response) {\r\n        callback.call(context, error, response, response);\r\n      }, this);\r\n    } else {\r\n      console.warn('this geocoding service does not support asking for suggestions');\r\n    }\r\n  }\r\n\r\n});\r\n\r\nexport function suggest (options) {\r\n  return new Suggest(options);\r\n}\r\n\r\nexport default suggest;\r\n","import { Service } from 'esri-leaflet';\r\nimport { WorldGeocodingServiceUrl } from '../helper';\r\nimport geocode from '../Tasks/Geocode';\r\nimport reverseGeocode from '../Tasks/ReverseGeocode';\r\nimport suggest from '../Tasks/Suggest';\r\n\r\nexport var GeocodeService = Service.extend({\r\n  initialize: function (options) {\r\n    options = options || {};\r\n    if (options.apikey) {\r\n      options.token = options.apikey;\r\n    }\r\n    if (options.url) {\r\n      Service.prototype.initialize.call(this, options);\r\n      this._confirmSuggestSupport();\r\n    } else {\r\n      options.url = WorldGeocodingServiceUrl;\r\n      options.supportsSuggest = true;\r\n      Service.prototype.initialize.call(this, options);\r\n    }\r\n  },\r\n\r\n  geocode: function () {\r\n    return geocode(this);\r\n  },\r\n\r\n  reverse: function () {\r\n    return reverseGeocode(this);\r\n  },\r\n\r\n  suggest: function () {\r\n    // requires either the Esri World Geocoding Service or a <10.3 ArcGIS Server Geocoding Service that supports suggest.\r\n    return suggest(this);\r\n  },\r\n\r\n  _confirmSuggestSupport: function () {\r\n    this.metadata(function (error, response) {\r\n      if (error) { return; }\r\n      // pre 10.3 geocoding services dont list capabilities (and dont support maxLocations)\r\n      // only SOME individual services have been configured to support asking for suggestions\r\n      if (!response.capabilities) {\r\n        this.options.supportsSuggest = false;\r\n      } else if (response.capabilities.indexOf('Suggest') > -1) {\r\n        this.options.supportsSuggest = true;\r\n      } else {\r\n        this.options.supportsSuggest = false;\r\n      }\r\n      // whether the service supports suggest or not, utilize the metadata response to determine the appropriate parameter name for single line geocoding requests\r\n      this.options.customParam = response.singleLineAddressField.name;\r\n    }, this);\r\n  }\r\n});\r\n\r\nexport function geocodeService (options) {\r\n  return new GeocodeService(options);\r\n}\r\n\r\nexport default geocodeService;\r\n","import { Evented, Util, latLngBounds } from 'leaflet';\r\n\r\nexport var GeosearchCore = Evented.extend({\r\n\r\n  options: {\r\n    zoomToResult: true,\r\n    useMapBounds: 12,\r\n    searchBounds: null\r\n  },\r\n\r\n  initialize: function (control, options) {\r\n    Util.setOptions(this, options);\r\n    this._control = control;\r\n\r\n    if (!options || !options.providers || !options.providers.length) {\r\n      throw new Error('You must specify at least one provider');\r\n    }\r\n\r\n    this._providers = options.providers;\r\n  },\r\n\r\n  _geocode: function (text, key, provider) {\r\n    var activeRequests = 0;\r\n    var allResults = [];\r\n    var bounds;\r\n\r\n    var callback = Util.bind(function (error, results) {\r\n      activeRequests--;\r\n      if (error) {\r\n        return;\r\n      }\r\n\r\n      if (results) {\r\n        allResults = allResults.concat(results);\r\n      }\r\n\r\n      if (activeRequests <= 0) {\r\n        bounds = this._boundsFromResults(allResults);\r\n\r\n        this.fire('results', {\r\n          results: allResults,\r\n          bounds: bounds,\r\n          latlng: (bounds) ? bounds.getCenter() : undefined,\r\n          text: text\r\n        }, true);\r\n\r\n        if (this.options.zoomToResult && bounds) {\r\n          this._control._map.fitBounds(bounds);\r\n        }\r\n\r\n        this.fire('load');\r\n      }\r\n    }, this);\r\n\r\n    if (key) {\r\n      activeRequests++;\r\n      provider.results(text, key, this._searchBounds(), callback);\r\n    } else {\r\n      for (var i = 0; i < this._providers.length; i++) {\r\n        activeRequests++;\r\n        this._providers[i].results(text, key, this._searchBounds(), callback);\r\n      }\r\n    }\r\n  },\r\n\r\n  _suggest: function (text) {\r\n    var activeRequests = this._providers.length;\r\n    var suggestionsLength = 0;\r\n\r\n    var createCallback = Util.bind(function (text, provider) {\r\n      return Util.bind(function (error, suggestions) {\r\n        activeRequests = activeRequests - 1;\r\n        suggestionsLength += suggestions.length;\r\n\r\n        if (error) {\r\n          // an error occurred for one of the providers' suggest requests\r\n          this._control._clearProviderSuggestions(provider);\r\n\r\n          // perform additional cleanup when all requests are finished\r\n          this._control._finalizeSuggestions(activeRequests, suggestionsLength);\r\n\r\n          return;\r\n        }\r\n\r\n        if (suggestions.length) {\r\n          for (var i = 0; i < suggestions.length; i++) {\r\n            suggestions[i].provider = provider;\r\n          }\r\n        } else {\r\n          // we still need to update the UI\r\n          this._control._renderSuggestions(suggestions);\r\n        }\r\n\r\n        if (provider._lastRender !== text) {\r\n          this._control._clearProviderSuggestions(provider);\r\n        }\r\n\r\n        if (suggestions.length && this._control._input.value === text) {\r\n          provider._lastRender = text;\r\n          this._control._renderSuggestions(suggestions);\r\n        }\r\n\r\n        // perform additional cleanup when all requests are finished\r\n        this._control._finalizeSuggestions(activeRequests, suggestionsLength);\r\n      }, this);\r\n    }, this);\r\n\r\n    this._pendingSuggestions = [];\r\n\r\n    for (var i = 0; i < this._providers.length; i++) {\r\n      var provider = this._providers[i];\r\n      var request = provider.suggestions(text, this._searchBounds(), createCallback(text, provider));\r\n      this._pendingSuggestions.push(request);\r\n    }\r\n  },\r\n\r\n  _searchBounds: function () {\r\n    if (this.options.searchBounds !== null) {\r\n      return this.options.searchBounds;\r\n    }\r\n\r\n    if (this.options.useMapBounds === false) {\r\n      return null;\r\n    }\r\n\r\n    if (this.options.useMapBounds === true) {\r\n      return this._control._map.getBounds();\r\n    }\r\n\r\n    if (this.options.useMapBounds <= this._control._map.getZoom()) {\r\n      return this._control._map.getBounds();\r\n    }\r\n\r\n    return null;\r\n  },\r\n\r\n  _boundsFromResults: function (results) {\r\n    if (!results.length) {\r\n      return;\r\n    }\r\n\r\n    var nullIsland = latLngBounds([0, 0], [0, 0]);\r\n    var resultBounds = [];\r\n    var resultLatlngs = [];\r\n\r\n    // collect the bounds and center of each result\r\n    for (var i = results.length - 1; i >= 0; i--) {\r\n      var result = results[i];\r\n\r\n      resultLatlngs.push(result.latlng);\r\n\r\n      // make sure bounds are valid and not 0,0. sometimes bounds are incorrect or not present\r\n      if (result.bounds && result.bounds.isValid() && !result.bounds.equals(nullIsland)) {\r\n        resultBounds.push(result.bounds);\r\n      }\r\n    }\r\n\r\n    // form a bounds object containing all center points\r\n    var bounds = latLngBounds(resultLatlngs);\r\n\r\n    // and extend it to contain all bounds objects\r\n    for (var j = 0; j < resultBounds.length; j++) {\r\n      bounds.extend(resultBounds[j]);\r\n    }\r\n\r\n    return bounds;\r\n  },\r\n\r\n  _getAttribution: function () {\r\n    var attribs = [];\r\n    var providers = this._providers;\r\n\r\n    for (var i = 0; i < providers.length; i++) {\r\n      if (providers[i].options.attribution) {\r\n        attribs.push(providers[i].options.attribution);\r\n      }\r\n    }\r\n\r\n    return attribs.join(', ');\r\n  }\r\n\r\n});\r\n\r\nexport function geosearchCore (control, options) {\r\n  return new GeosearchCore(control, options);\r\n}\r\n\r\nexport default geosearchCore;\r\n","import { GeocodeService } from '../Services/Geocode';\r\n\r\nexport var ArcgisOnlineProvider = GeocodeService.extend({\r\n  options: {\r\n    label: 'Places and Addresses',\r\n    maxResults: 5\r\n  },\r\n\r\n  suggestions: function (text, bounds, callback) {\r\n    var request = this.suggest().text(text);\r\n\r\n    if (bounds) {\r\n      request.within(bounds);\r\n    }\r\n\r\n    if (this.options.nearby) {\r\n      // \"distance\"/\"radius\" is not supported by the ArcGIS Online Geocoder,\r\n      // so that is intentionally not passed here:\r\n      request.nearby(this.options.nearby);\r\n    }\r\n\r\n    if (this.options.countries) {\r\n      request.countries(this.options.countries);\r\n    }\r\n\r\n    if (this.options.categories) {\r\n      request.category(this.options.categories);\r\n    }\r\n\r\n    // 15 is the maximum number of suggestions that can be returned\r\n    request.maxSuggestions(this.options.maxResults);\r\n\r\n    return request.run(function (error, results, response) {\r\n      var suggestions = [];\r\n      if (!error) {\r\n        while (response.suggestions.length && suggestions.length <= (this.options.maxResults - 1)) {\r\n          var suggestion = response.suggestions.shift();\r\n          if (!suggestion.isCollection) {\r\n            suggestions.push({\r\n              text: suggestion.text,\r\n              unformattedText: suggestion.text,\r\n              magicKey: suggestion.magicKey\r\n            });\r\n          }\r\n        }\r\n      }\r\n      callback(error, suggestions);\r\n    }, this);\r\n  },\r\n\r\n  results: function (text, key, bounds, callback) {\r\n    var request = this.geocode().text(text);\r\n\r\n    if (key) {\r\n      request.key(key);\r\n    }\r\n    // in the future Address/StreetName geocoding requests that include a magicKey will always only return one match\r\n    request.maxLocations(this.options.maxResults);\r\n\r\n    if (bounds) {\r\n      request.within(bounds);\r\n    }\r\n\r\n    if (this.options.forStorage) {\r\n      request.forStorage(true);\r\n    }\r\n\r\n    if (this.options.nearby) {\r\n      // \"distance\"/\"radius\" is not supported by the ArcGIS Online Geocoder,\r\n      // so that is intentionally not passed here:\r\n      request.nearby(this.options.nearby);\r\n    }\r\n\r\n    if (this.options.countries) {\r\n      request.countries(this.options.countries);\r\n    }\r\n\r\n    if (this.options.categories) {\r\n      request.category(this.options.categories);\r\n    }\r\n\r\n    return request.run(function (error, response) {\r\n      callback(error, response.results);\r\n    }, this);\r\n  }\r\n});\r\n\r\nexport function arcgisOnlineProvider (options) {\r\n  return new ArcgisOnlineProvider(options);\r\n}\r\n\r\nexport default arcgisOnlineProvider;\r\n","import {\r\n  Control,\r\n  DomEvent,\r\n  DomUtil,\r\n  Evented,\r\n  Util,\r\n  latLngBounds\r\n} from 'leaflet';\r\nimport { geosearchCore } from '../Classes/GeosearchCore';\r\nimport { arcgisOnlineProvider } from '../Providers/ArcgisOnlineGeocoder';\r\nimport { Util as EsriUtil } from 'esri-leaflet';\r\n\r\nexport var Geosearch = Control.extend({\r\n  includes: Evented.prototype,\r\n\r\n  options: {\r\n    position: 'topleft',\r\n    collapseAfterResult: true,\r\n    expanded: false,\r\n    allowMultipleResults: true,\r\n    placeholder: 'Search for places or addresses',\r\n    title: 'Location Search'\r\n  },\r\n\r\n  initialize: function (options) {\r\n    Util.setOptions(this, options);\r\n\r\n    if (!options || !options.providers || !options.providers.length) {\r\n      if (!options) {\r\n        options = {};\r\n      }\r\n      options.providers = [ arcgisOnlineProvider() ];\r\n    }\r\n\r\n    // instantiate the underlying class and pass along options\r\n    this._geosearchCore = geosearchCore(this, options);\r\n    this._geosearchCore._providers = options.providers;\r\n\r\n    // bubble each providers events to the control\r\n    this._geosearchCore.addEventParent(this);\r\n    for (var i = 0; i < this._geosearchCore._providers.length; i++) {\r\n      this._geosearchCore._providers[i].addEventParent(this);\r\n    }\r\n\r\n    this._geosearchCore._pendingSuggestions = [];\r\n\r\n    Control.prototype.initialize.call(this, options);\r\n  },\r\n\r\n  _renderSuggestions: function (suggestions) {\r\n    var currentGroup;\r\n\r\n    if (suggestions.length > 0) {\r\n      this._suggestions.style.display = 'block';\r\n    }\r\n\r\n    var list;\r\n    var header;\r\n    var suggestionTextArray = [];\r\n\r\n    for (var i = 0; i < suggestions.length; i++) {\r\n      var suggestion = suggestions[i];\r\n      if (!header && this._geosearchCore._providers.length > 1 && currentGroup !== suggestion.provider.options.label) {\r\n        header = DomUtil.create('div', 'geocoder-control-header', suggestion.provider._contentsElement);\r\n        header.textContent = suggestion.provider.options.label;\r\n        header.innerText = suggestion.provider.options.label;\r\n        currentGroup = suggestion.provider.options.label;\r\n      }\r\n\r\n      if (!list) {\r\n        list = DomUtil.create('ul', 'geocoder-control-list', suggestion.provider._contentsElement);\r\n      }\r\n\r\n      if (suggestionTextArray.indexOf(suggestion.text) === -1) {\r\n        var suggestionItem = DomUtil.create('li', 'geocoder-control-suggestion', list);\r\n\r\n        suggestionItem.innerHTML = suggestion.text;\r\n        suggestionItem.provider = suggestion.provider;\r\n        suggestionItem['data-magic-key'] = suggestion.magicKey;\r\n        suggestionItem.unformattedText = suggestion.unformattedText;\r\n      } else {\r\n        for (var j = 0; j < list.childNodes.length; j++) {\r\n          // if the same text already appears in the list of suggestions, append an additional ObjectID to its magicKey instead\r\n          if (list.childNodes[j].innerHTML === suggestion.text) {\r\n            list.childNodes[j]['data-magic-key'] += ',' + suggestion.magicKey;\r\n          }\r\n        }\r\n      }\r\n      suggestionTextArray.push(suggestion.text);\r\n    }\r\n\r\n    // when the geocoder position is either \"topleft\" or \"topright\":\r\n    // set the maxHeight of the suggestions box to:\r\n    //  map height\r\n    //  - suggestions offset (distance from top of suggestions to top of control)\r\n    //  - control offset (distance from top of control to top of map)\r\n    //  - 10 (extra padding)\r\n    if (this.getPosition().indexOf('top') > -1) {\r\n      this._suggestions.style.maxHeight = (this._map.getSize().y - this._suggestions.offsetTop - this._wrapper.offsetTop - 10) + 'px';\r\n    }\r\n\r\n    // when the geocoder position is either \"bottomleft\" or \"bottomright\":\r\n    // 1. set the maxHeight of the suggestions box to:\r\n    //  map height\r\n    //  - corner control container offsetHeight (height of container of bottom corner)\r\n    //  - control offsetHeight (height of geocoder control wrapper, the main expandable button)\r\n    // 2. to move it up, set the top of the suggestions box to:\r\n    //  negative offsetHeight of suggestions box (its own negative height now that it has children elements\r\n    //  - control offsetHeight (height of geocoder control wrapper, the main expandable button)\r\n    //  + 20 (extra spacing)\r\n    if (this.getPosition().indexOf('bottom') > -1) {\r\n      this._setSuggestionsBottomPosition();\r\n    }\r\n  },\r\n\r\n  _setSuggestionsBottomPosition: function () {\r\n    this._suggestions.style.maxHeight = (this._map.getSize().y - this._map._controlCorners[this.getPosition()].offsetHeight - this._wrapper.offsetHeight) + 'px';\r\n    this._suggestions.style.top = (-this._suggestions.offsetHeight - this._wrapper.offsetHeight + 20) + 'px';\r\n  },\r\n\r\n  _boundsFromResults: function (results) {\r\n    if (!results.length) {\r\n      return;\r\n    }\r\n\r\n    var nullIsland = latLngBounds([0, 0], [0, 0]);\r\n    var resultBounds = [];\r\n    var resultLatlngs = [];\r\n\r\n    // collect the bounds and center of each result\r\n    for (var i = results.length - 1; i >= 0; i--) {\r\n      var result = results[i];\r\n\r\n      resultLatlngs.push(result.latlng);\r\n\r\n      // make sure bounds are valid and not 0,0. sometimes bounds are incorrect or not present\r\n      if (result.bounds && result.bounds.isValid() && !result.bounds.equals(nullIsland)) {\r\n        resultBounds.push(result.bounds);\r\n      }\r\n    }\r\n\r\n    // form a bounds object containing all center points\r\n    var bounds = latLngBounds(resultLatlngs);\r\n\r\n    // and extend it to contain all bounds objects\r\n    for (var j = 0; j < resultBounds.length; j++) {\r\n      bounds.extend(resultBounds[j]);\r\n    }\r\n\r\n    return bounds;\r\n  },\r\n\r\n  clear: function () {\r\n    this._clearAllSuggestions();\r\n\r\n    if (this.options.collapseAfterResult) {\r\n      this._input.value = '';\r\n      this._lastValue = '';\r\n      this._input.placeholder = '';\r\n      DomUtil.removeClass(this._wrapper, 'geocoder-control-expanded');\r\n    }\r\n\r\n    if (!this._map.scrollWheelZoom.enabled() && this._map.options.scrollWheelZoom) {\r\n      this._map.scrollWheelZoom.enable();\r\n    }\r\n  },\r\n\r\n  _clearAllSuggestions: function () {\r\n    this._suggestions.style.display = 'none';\r\n\r\n    for (var i = 0; i < this.options.providers.length; i++) {\r\n      this._clearProviderSuggestions(this.options.providers[i]);\r\n    }\r\n  },\r\n\r\n  _clearProviderSuggestions: function (provider) {\r\n    provider._contentsElement.innerHTML = '';\r\n  },\r\n\r\n  _finalizeSuggestions: function (activeRequests, suggestionsLength) {\r\n    // check if all requests are finished to remove the loading indicator\r\n    if (!activeRequests) {\r\n      DomUtil.removeClass(this._input, 'geocoder-control-loading');\r\n\r\n      // when the geocoder position is either \"bottomleft\" or \"bottomright\",\r\n      // it is necessary in some cases to recalculate the maxHeight and top values of the this._suggestions element,\r\n      // even though this is also being done after each provider returns their own suggestions\r\n      if (this.getPosition().indexOf('bottom') > -1) {\r\n        this._setSuggestionsBottomPosition();\r\n      }\r\n\r\n      // also check if there were 0 total suggest results to clear the parent suggestions element\r\n      // otherwise its display value may be \"block\" instead of \"none\"\r\n      if (!suggestionsLength) {\r\n        this._clearAllSuggestions();\r\n      }\r\n    }\r\n  },\r\n\r\n  _setupClick: function () {\r\n    DomUtil.addClass(this._wrapper, 'geocoder-control-expanded');\r\n    this._input.focus();\r\n  },\r\n\r\n  disable: function () {\r\n    this._input.disabled = true;\r\n    DomUtil.addClass(this._input, 'geocoder-control-input-disabled');\r\n    DomEvent.removeListener(this._wrapper, 'click', this._setupClick, this);\r\n  },\r\n\r\n  enable: function () {\r\n    this._input.disabled = false;\r\n    DomUtil.removeClass(this._input, 'geocoder-control-input-disabled');\r\n    DomEvent.addListener(this._wrapper, 'click', this._setupClick, this);\r\n  },\r\n\r\n  getAttribution: function () {\r\n    var attribs = [];\r\n\r\n    for (var i = 0; i < this._providers.length; i++) {\r\n      if (this._providers[i].options.attribution) {\r\n        attribs.push(this._providers[i].options.attribution);\r\n      }\r\n    }\r\n\r\n    return attribs.join(', ');\r\n  },\r\n\r\n  geocodeSuggestion: function (e) {\r\n    var suggestionItem = e.target || e.srcElement;\r\n\r\n    if (\r\n      suggestionItem.classList.contains('geocoder-control-suggestions') ||\r\n      suggestionItem.classList.contains('geocoder-control-header')\r\n    ) {\r\n      return;\r\n    }\r\n\r\n    // make sure and point at the actual 'geocoder-control-suggestion'\r\n    if (suggestionItem.classList.length < 1) {\r\n      suggestionItem = suggestionItem.parentNode;\r\n    }\r\n\r\n    this._geosearchCore._geocode(suggestionItem.unformattedText, suggestionItem['data-magic-key'], suggestionItem.provider);\r\n    this.clear();\r\n  },\r\n\r\n  onAdd: function (map) {\r\n    // include 'Powered by Esri' in map attribution\r\n    EsriUtil.setEsriAttribution(map);\r\n\r\n    this._map = map;\r\n    this._wrapper = DomUtil.create('div', 'geocoder-control');\r\n    this._input = DomUtil.create('input', 'geocoder-control-input leaflet-bar', this._wrapper);\r\n    this._input.title = this.options.title;\r\n\r\n    if (this.options.expanded) {\r\n      DomUtil.addClass(this._wrapper, 'geocoder-control-expanded');\r\n      this._input.placeholder = this.options.placeholder;\r\n    }\r\n\r\n    // create the main suggested results container element\r\n    this._suggestions = DomUtil.create('div', 'geocoder-control-suggestions leaflet-bar', this._wrapper);\r\n\r\n    // create a child contents container element for each provider inside of this._suggestions\r\n    // to maintain the configured order of providers for suggested results\r\n    for (var i = 0; i < this.options.providers.length; i++) {\r\n      this.options.providers[i]._contentsElement = DomUtil.create('div', null, this._suggestions);\r\n    }\r\n\r\n    var credits = this._geosearchCore._getAttribution();\r\n\r\n    if (map.attributionControl) {\r\n      map.attributionControl.addAttribution(credits);\r\n    }\r\n\r\n    DomEvent.addListener(this._input, 'focus', function (e) {\r\n      this._input.placeholder = this.options.placeholder;\r\n      DomUtil.addClass(this._wrapper, 'geocoder-control-expanded');\r\n    }, this);\r\n\r\n    DomEvent.addListener(this._wrapper, 'click', this._setupClick, this);\r\n\r\n    // make sure both click and touch spawn an address/poi search\r\n    DomEvent.addListener(this._suggestions, 'mousedown', this.geocodeSuggestion, this);\r\n\r\n    DomEvent.addListener(this._input, 'blur', function (e) {\r\n      // TODO: this is too greedy and should not \"clear\"\r\n      // when trying to use the scrollbar or clicking on a non-suggestion item (such as a provider header)\r\n      this.clear();\r\n    }, this);\r\n\r\n    DomEvent.addListener(this._input, 'keydown', function (e) {\r\n      var text = (e.target || e.srcElement).value;\r\n\r\n      DomUtil.addClass(this._wrapper, 'geocoder-control-expanded');\r\n\r\n      var list = this._suggestions.querySelectorAll('.' + 'geocoder-control-suggestion');\r\n      var selected = this._suggestions.querySelectorAll('.' + 'geocoder-control-selected')[0];\r\n      var selectedPosition;\r\n\r\n      for (var i = 0; i < list.length; i++) {\r\n        if (list[i] === selected) {\r\n          selectedPosition = i;\r\n          break;\r\n        }\r\n      }\r\n\r\n      switch (e.keyCode) {\r\n        case 13:\r\n          /*\r\n            if an item has been selected, geocode it\r\n            if focus is on the input textbox, geocode only if multiple results are allowed and more than two characters are present, or if a single suggestion is displayed.\r\n            if less than two characters have been typed, abort the geocode\r\n          */\r\n          if (selected) {\r\n            this._input.value = selected.innerText;\r\n            this._geosearchCore._geocode(selected.unformattedText, selected['data-magic-key'], selected.provider);\r\n            this.clear();\r\n          } else if (this.options.allowMultipleResults && text.length >= 2) {\r\n            this._geosearchCore._geocode(this._input.value, undefined);\r\n            this.clear();\r\n          } else {\r\n            if (list.length === 1) {\r\n              DomUtil.addClass(list[0], 'geocoder-control-selected');\r\n              this._geosearchCore._geocode(list[0].innerHTML, list[0]['data-magic-key'], list[0].provider);\r\n            } else {\r\n              this.clear();\r\n              this._input.blur();\r\n            }\r\n          }\r\n          DomEvent.preventDefault(e);\r\n          break;\r\n        case 38:\r\n          if (selected) {\r\n            DomUtil.removeClass(selected, 'geocoder-control-selected');\r\n          }\r\n\r\n          var previousItem = list[selectedPosition - 1];\r\n\r\n          if (selected && previousItem) {\r\n            DomUtil.addClass(previousItem, 'geocoder-control-selected');\r\n          } else {\r\n            DomUtil.addClass(list[list.length - 1], 'geocoder-control-selected');\r\n          }\r\n          DomEvent.preventDefault(e);\r\n          break;\r\n        case 40:\r\n          if (selected) {\r\n            DomUtil.removeClass(selected, 'geocoder-control-selected');\r\n          }\r\n\r\n          var nextItem = list[selectedPosition + 1];\r\n\r\n          if (selected && nextItem) {\r\n            DomUtil.addClass(nextItem, 'geocoder-control-selected');\r\n          } else {\r\n            DomUtil.addClass(list[0], 'geocoder-control-selected');\r\n          }\r\n          DomEvent.preventDefault(e);\r\n          break;\r\n        default:\r\n          // when the input changes we should cancel all pending suggestion requests if possible to avoid result collisions\r\n          for (var x = 0; x < this._geosearchCore._pendingSuggestions.length; x++) {\r\n            var request = this._geosearchCore._pendingSuggestions[x];\r\n            if (request && request.abort && !request.id) {\r\n              request.abort();\r\n            }\r\n          }\r\n          break;\r\n      }\r\n    }, this);\r\n\r\n    DomEvent.addListener(this._input, 'keyup', Util.throttle(function (e) {\r\n      var key = e.which || e.keyCode;\r\n      var text = (e.target || e.srcElement).value;\r\n\r\n      // require at least 2 characters for suggestions\r\n      if (text.length < 2) {\r\n        this._lastValue = this._input.value;\r\n        this._clearAllSuggestions();\r\n        DomUtil.removeClass(this._input, 'geocoder-control-loading');\r\n        return;\r\n      }\r\n\r\n      // if this is the escape key it will clear the input so clear suggestions\r\n      if (key === 27) {\r\n        this._clearAllSuggestions();\r\n        return;\r\n      }\r\n\r\n      // if this is NOT the up/down arrows or enter make a suggestion\r\n      if (key !== 13 && key !== 38 && key !== 40) {\r\n        if (this._input.value !== this._lastValue) {\r\n          this._lastValue = this._input.value;\r\n          DomUtil.addClass(this._input, 'geocoder-control-loading');\r\n          this._geosearchCore._suggest(text);\r\n        }\r\n      }\r\n    }, 50, this), this);\r\n\r\n    DomEvent.disableClickPropagation(this._wrapper);\r\n\r\n    // when mouse moves over suggestions disable scroll wheel zoom if its enabled\r\n    DomEvent.addListener(this._suggestions, 'mouseover', function (e) {\r\n      if (map.scrollWheelZoom.enabled() && map.options.scrollWheelZoom) {\r\n        map.scrollWheelZoom.disable();\r\n      }\r\n    });\r\n\r\n    // when mouse moves leaves suggestions enable scroll wheel zoom if its disabled\r\n    DomEvent.addListener(this._suggestions, 'mouseout', function (e) {\r\n      if (!map.scrollWheelZoom.enabled() && map.options.scrollWheelZoom) {\r\n        map.scrollWheelZoom.enable();\r\n      }\r\n    });\r\n\r\n    this._geosearchCore.on('load', function (e) {\r\n      DomUtil.removeClass(this._input, 'geocoder-control-loading');\r\n      this.clear();\r\n      this._input.blur();\r\n    }, this);\r\n\r\n    return this._wrapper;\r\n  }\r\n});\r\n\r\nexport function geosearch (options) {\r\n  return new Geosearch(options);\r\n}\r\n\r\nexport default geosearch;\r\n","import { Util, geoJson, latLngBounds } from 'leaflet';\r\nimport { FeatureLayerService } from 'esri-leaflet';\r\n\r\nexport var FeatureLayerProvider = FeatureLayerService.extend({\r\n  options: {\r\n    label: 'Feature Layer',\r\n    maxResults: 5,\r\n    bufferRadius: 1000,\r\n    searchMode: 'contain',\r\n    formatSuggestion: function (feature) {\r\n      return feature.properties[this.options.searchFields[0]];\r\n    }\r\n  },\r\n\r\n  initialize: function (options) {\r\n    if (options.apikey) {\r\n      options.token = options.apikey;\r\n    }\r\n    FeatureLayerService.prototype.initialize.call(this, options);\r\n    if (typeof this.options.searchFields === 'string') {\r\n      this.options.searchFields = [this.options.searchFields];\r\n    }\r\n    this._suggestionsQuery = this.query();\r\n    this._resultsQuery = this.query();\r\n  },\r\n\r\n  suggestions: function (text, bounds, callback) {\r\n    var query = this._suggestionsQuery.where(this._buildQuery(text))\r\n      .returnGeometry(false);\r\n\r\n    if (bounds) {\r\n      query.intersects(bounds);\r\n    }\r\n\r\n    if (this.options.idField) {\r\n      query.fields([this.options.idField].concat(this.options.searchFields));\r\n    }\r\n\r\n    var request = query.run(function (error, results, raw) {\r\n      if (error) {\r\n        callback(error, []);\r\n      } else {\r\n        this.options.idField = raw.objectIdFieldName;\r\n        var suggestions = [];\r\n        for (var i = results.features.length - 1; i >= 0; i--) {\r\n          var feature = results.features[i];\r\n          suggestions.push({\r\n            text: this.options.formatSuggestion.call(this, feature),\r\n            unformattedText: feature.properties[this.options.searchFields[0]],\r\n            magicKey: feature.id\r\n          });\r\n        }\r\n        callback(error, suggestions.slice(0, this.options.maxResults));\r\n      }\r\n    }, this);\r\n\r\n    return request;\r\n  },\r\n\r\n  results: function (text, key, bounds, callback) {\r\n    var query = this._resultsQuery;\r\n\r\n    if (key) {\r\n      // if there are 1 or more keys available, use query.featureIds()\r\n      delete query.params.where;\r\n      query.featureIds([key]);\r\n    } else {\r\n      // if there are no keys available, use query.where()\r\n      query.where(this._buildQuery(text));\r\n    }\r\n\r\n    if (bounds) {\r\n      query.within(bounds);\r\n    }\r\n\r\n    return query.run(Util.bind(function (error, features) {\r\n      var results = [];\r\n      for (var i = 0; i < features.features.length; i++) {\r\n        var feature = features.features[i];\r\n        if (feature) {\r\n          var bounds = this._featureBounds(feature);\r\n\r\n          var result = {\r\n            latlng: bounds.getCenter(),\r\n            bounds: bounds,\r\n            text: this.options.formatSuggestion.call(this, feature),\r\n            properties: feature.properties,\r\n            geojson: feature\r\n          };\r\n\r\n          results.push(result);\r\n\r\n          // clear query parameters for the next search\r\n          delete this._resultsQuery.params['objectIds'];\r\n        }\r\n      }\r\n      callback(error, results);\r\n    }, this));\r\n  },\r\n\r\n  orderBy: function (fieldName, order) {\r\n    this._suggestionsQuery.orderBy(fieldName, order);\r\n  },\r\n\r\n  _buildQuery: function (text) {\r\n    var queryString = [];\r\n\r\n    for (var i = this.options.searchFields.length - 1; i >= 0; i--) {\r\n      var field = 'upper(\"' + this.options.searchFields[i] + '\")';\r\n      if (this.options.searchMode === 'contain') {\r\n        queryString.push(field + \" LIKE upper('%\" + text + \"%')\");\r\n      } else if (this.options.searchMode === 'startWith') {\r\n        queryString.push(field + \" LIKE upper('\" + text + \"%')\");\r\n      } else if (this.options.searchMode === 'endWith') {\r\n        queryString.push(field + \" LIKE upper('%\" + text + \"')\");\r\n      } else if (this.options.searchMode === 'strict') {\r\n        queryString.push(field + \" LIKE upper('\" + text + \"')\");\r\n      } else {\r\n        throw new Error('L.esri.Geocoding.featureLayerProvider: Invalid parameter for \"searchMode\". Use one of \"contain\", \"startWith\", \"endWith\", or \"strict\"');\r\n      }\r\n    }\r\n    if (this.options.where) {\r\n      return this.options.where + ' AND (' + queryString.join(' OR ') + ')';\r\n    } else {\r\n      return queryString.join(' OR ');\r\n    }\r\n  },\r\n\r\n  _featureBounds: function (feature) {\r\n    var geojson = geoJson(feature);\r\n    if (feature.geometry.type === 'Point') {\r\n      var center = geojson.getBounds().getCenter();\r\n      var lngRadius = ((this.options.bufferRadius / 40075017) * 360) / Math.cos((180 / Math.PI) * center.lat);\r\n      var latRadius = (this.options.bufferRadius / 40075017) * 360;\r\n      return latLngBounds([center.lat - latRadius, center.lng - lngRadius], [center.lat + latRadius, center.lng + lngRadius]);\r\n    } else {\r\n      return geojson.getBounds();\r\n    }\r\n  }\r\n});\r\n\r\nexport function featureLayerProvider (options) {\r\n  return new FeatureLayerProvider(options);\r\n}\r\n\r\nexport default featureLayerProvider;\r\n","import { Util, geoJson, latLngBounds } from 'leaflet';\r\nimport { MapService } from 'esri-leaflet';\r\n\r\nexport var MapServiceProvider = MapService.extend({\r\n  options: {\r\n    layers: [0],\r\n    label: 'Map Service',\r\n    bufferRadius: 1000,\r\n    maxResults: 5,\r\n    formatSuggestion: function (feature) {\r\n      return feature.properties[feature.displayFieldName] + ' <small>' + feature.layerName + '</small>';\r\n    }\r\n  },\r\n\r\n  initialize: function (options) {\r\n    if (options.apikey) {\r\n      options.token = options.apikey;\r\n    }\r\n    MapService.prototype.initialize.call(this, options);\r\n    this._getIdFields();\r\n  },\r\n\r\n  suggestions: function (text, bounds, callback) {\r\n    var request = this.find().text(text).fields(this.options.searchFields).returnGeometry(false).layers(this.options.layers);\r\n\r\n    return request.run(function (error, results, raw) {\r\n      var suggestions = [];\r\n      if (!error) {\r\n        var count = Math.min(this.options.maxResults, results.features.length);\r\n        raw.results = raw.results.reverse();\r\n        for (var i = 0; i < count; i++) {\r\n          var feature = results.features[i];\r\n          var result = raw.results[i];\r\n          var layer = result.layerId;\r\n          var idField = this._idFields[layer];\r\n          feature.layerId = layer;\r\n          feature.layerName = this._layerNames[layer];\r\n          feature.displayFieldName = this._displayFields[layer];\r\n          if (idField) {\r\n            suggestions.push({\r\n              text: this.options.formatSuggestion.call(this, feature),\r\n              unformattedText: feature.properties[feature.displayFieldName],\r\n              magicKey: result.attributes[idField] + ':' + layer\r\n            });\r\n          }\r\n        }\r\n      }\r\n      callback(error, suggestions.reverse());\r\n    }, this);\r\n  },\r\n\r\n  results: function (text, key, bounds, callback) {\r\n    var results = [];\r\n    var request;\r\n\r\n    if (key && !key.includes(',')) {\r\n      // if there is only 1 key available, use query()\r\n      var featureId = key.split(':')[0];\r\n      var layer = key.split(':')[1];\r\n      request = this.query().layer(layer).featureIds(featureId);\r\n    } else {\r\n      // if there are no keys or more than 1 keys available, use find()\r\n      request = this.find().text(text).fields(this.options.searchFields).layers(this.options.layers);\r\n    }\r\n\r\n    return request.run(function (error, features, response) {\r\n      if (!error) {\r\n        if (response.results) {\r\n          response.results = response.results.reverse();\r\n        }\r\n        for (var i = 0; i < features.features.length; i++) {\r\n          var feature = features.features[i];\r\n          layer = layer || response.results[i].layerId;\r\n\r\n          if (feature && layer !== undefined) {\r\n            var bounds = this._featureBounds(feature);\r\n            feature.layerId = layer;\r\n            feature.layerName = this._layerNames[layer];\r\n            feature.displayFieldName = this._displayFields[layer];\r\n\r\n            var result = {\r\n              latlng: bounds.getCenter(),\r\n              bounds: bounds,\r\n              text: this.options.formatSuggestion.call(this, feature),\r\n              properties: feature.properties,\r\n              geojson: feature\r\n            };\r\n\r\n            results.push(result);\r\n          }\r\n        }\r\n      }\r\n      callback(error, results.reverse());\r\n    }, this);\r\n  },\r\n\r\n  _featureBounds: function (feature) {\r\n    var geojson = geoJson(feature);\r\n    if (feature.geometry.type === 'Point') {\r\n      var center = geojson.getBounds().getCenter();\r\n      var lngRadius = ((this.options.bufferRadius / 40075017) * 360) / Math.cos((180 / Math.PI) * center.lat);\r\n      var latRadius = (this.options.bufferRadius / 40075017) * 360;\r\n      return latLngBounds([center.lat - latRadius, center.lng - lngRadius], [center.lat + latRadius, center.lng + lngRadius]);\r\n    } else {\r\n      return geojson.getBounds();\r\n    }\r\n  },\r\n\r\n  _layerMetadataCallback: function (layerid) {\r\n    return Util.bind(function (error, metadata) {\r\n      if (error) { return; }\r\n      this._displayFields[layerid] = metadata.displayField;\r\n      this._layerNames[layerid] = metadata.name;\r\n      for (var i = 0; i < metadata.fields.length; i++) {\r\n        var field = metadata.fields[i];\r\n        if (field.type === 'esriFieldTypeOID') {\r\n          this._idFields[layerid] = field.name;\r\n          break;\r\n        }\r\n      }\r\n    }, this);\r\n  },\r\n\r\n  _getIdFields: function () {\r\n    this._idFields = {};\r\n    this._displayFields = {};\r\n    this._layerNames = {};\r\n    for (var i = 0; i < this.options.layers.length; i++) {\r\n      var layer = this.options.layers[i];\r\n      this.get(layer, {}, this._layerMetadataCallback(layer));\r\n    }\r\n  }\r\n});\r\n\r\nexport function mapServiceProvider (options) {\r\n  return new MapServiceProvider(options);\r\n}\r\n\r\nexport default mapServiceProvider;\r\n","import { GeocodeService } from '../Services/Geocode';\r\n\r\nexport var GeocodeServiceProvider = GeocodeService.extend({\r\n  options: {\r\n    label: 'Geocode Server',\r\n    maxResults: 5\r\n  },\r\n\r\n  suggestions: function (text, bounds, callback) {\r\n    if (this.options.supportsSuggest) {\r\n      var request = this.suggest().text(text);\r\n      if (bounds) {\r\n        request.within(bounds);\r\n      }\r\n\r\n      return request.run(function (error, results, response) {\r\n        var suggestions = [];\r\n        if (!error) {\r\n          while (response.suggestions.length && suggestions.length <= (this.options.maxResults - 1)) {\r\n            var suggestion = response.suggestions.shift();\r\n            if (!suggestion.isCollection) {\r\n              suggestions.push({\r\n                text: suggestion.text,\r\n                unformattedText: suggestion.text,\r\n                magicKey: suggestion.magicKey\r\n              });\r\n            }\r\n          }\r\n        }\r\n        callback(error, suggestions);\r\n      }, this);\r\n    } else {\r\n      callback(undefined, []);\r\n      return false;\r\n    }\r\n  },\r\n\r\n  results: function (text, key, bounds, callback) {\r\n    var request = this.geocode().text(text);\r\n\r\n    if (key) {\r\n      request.key(key);\r\n    }\r\n\r\n    request.maxLocations(this.options.maxResults);\r\n\r\n    if (bounds) {\r\n      request.within(bounds);\r\n    }\r\n\r\n    return request.run(function (error, response) {\r\n      callback(error, response.results);\r\n    }, this);\r\n  }\r\n});\r\n\r\nexport function geocodeServiceProvider (options) {\r\n  return new GeocodeServiceProvider(options);\r\n}\r\n\r\nexport default geocodeServiceProvider;\r\n"]},"metadata":{},"sourceType":"script"}